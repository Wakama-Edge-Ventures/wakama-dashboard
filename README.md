Wakama Dashboard — Now Playing

Next.js (App Router) UI that displays, in real time, IPFS publications and Solana Devnet transactions for the Wakama Oracle pipeline.

Developed by Wakama Edge Ventures (Wakama.farm) — dev@wakama.farm
Supported by Solana Foundation

✨ Features

Now Playing view of the latest batches (IPFS CID, Solana Devnet Tx, SHA-256, timestamp).

Record-type classifier:

Sensor batch (field) (ingest source)

Coop delivery (RWA)

On-chain (publisher)

Simulated / placeholder

KPIs: files, unique CIDs, on-chain transactions, latest batch time.

Search with autocomplete (Explorer-style): search by CID, Tx, file name, or source.

Pagination + Back to top.

Clickable links:

CID → configurable IPFS gateway

Tx → Solana Explorer (Devnet)

SSR + fallback: the page reads /api/now on the server, and falls back to public/now.json on disk if the API is empty.

Solana-style UI: gradient background, glass cards, compact table.

🧱 Architecture
wakama-oracle-publisher
  └── receipts/*.json
       └── tools/build-now.cjs  →  ../wakama-dashboard/public/now.json
wakama-dashboard
  ├── GET /api/now  → reads public/now.json
  └── /now-playing  → SSR page, sorted by ts desc


public/now.json = aggregated snapshot generated by the publisher.

/api/now = optional API wrapper to serve that JSON.

/now-playing = UI that renders that snapshot (with filters, badges, pagination).

🔧 Prerequisites

Node.js 18+

Publisher installed next to the dashboard, e.g.:

~/dev/wakama/wakama-dashboard
~/dev/wakama/wakama-oracle-publisher
~/dev/wakama/wakama-rwa-templates


Solana Devnet access: https://api.devnet.solana.com

The dashboard expects the publisher to write to:
../wakama-dashboard/public/now.json

⚙️ Environment variables

Create a .env.local at the root of the dashboard:

NEXT_PUBLIC_BASE_URL=http://localhost:3000
NEXT_PUBLIC_RPC=https://api.devnet.solana.com
NEXT_PUBLIC_DASHBOARD_TITLE=Wakama Oracle
NEXT_PUBLIC_IPFS_GATEWAY=https://gateway.pinata.cloud/ipfs


For Vercel / production:

NEXT_PUBLIC_BASE_URL=https://your-dashboard.vercel.app
NEXT_PUBLIC_RPC=https://api.devnet.solana.com
NEXT_PUBLIC_IPFS_GATEWAY=https://gateway.pinata.cloud/ipfs


We also provide an example file you can commit:

.env.local.example

NEXT_PUBLIC_BASE_URL=http://localhost:3000
NEXT_PUBLIC_RPC=https://api.devnet.solana.com
NEXT_PUBLIC_IPFS_GATEWAY=https://gateway.pinata.cloud/ipfs


In your .gitignore, make sure this line exists:

!.env.local.example

🚀 Getting started
npm install
npm run dev
# open:
# http://localhost:3000/now-playing


The page will try, in order:

GET http://localhost:3000/api/now

if empty/unavailable → read public/now.json from disk

If you didn’t run the publisher yet, the table will be empty.

📦 Integration with the Publisher

In ~/dev/wakama/wakama-oracle-publisher you have two typical flows.

1) Simulated publish + snapshot update

node src/publish.cjs --sim
npm run export_now


2) Ingest a real JSON + snapshot update

node src/publish.cjs ingest/your-batch.json
npm run export_now


Both flows will:

create a receipt in wakama-oracle-publisher/receipts/*.json

rebuild the dashboard snapshot into
../wakama-dashboard/public/now.json

Then reload:

http://localhost:3000/now-playing


and the new line will appear.

🗂️ Expected snapshot format

The dashboard expects this shape for public/now.json:

{
  "totals": {
    "files": 3,
    "cids": 3,
    "onchainTx": 3,
    "lastTs": "2025-10-29T22:27:20.617Z"
  },
  "items": [
    {
      "cid": "Qm...",
      "tx": "5JKL...",
      "file": "wakama-batch-2025-10-29T22-27-20-617Z.json",
      "sha256": "bc0b...",
      "ts": "2025-10-29T22:27:20.617Z",
      "status": "confirmed",
      "slot": 288328921,
      "source": "ingest",
      "rwa_kind": "coop_delivery"
    }
  ]
}


status and source are displayed in the table.

if missing → UI falls back to —.

if rwa_kind is present → UI shows Coop delivery / Sensor batch (field) / etc.

🔌 Endpoints & Key Files

API: src/app/api/now/route.ts → GET /api/now → reads public/now.json

Page: src/app/now-playing/page.tsx → server, layout, background

Client UI: src/components/NowPlayingClient.tsx → search, pagination, table

Extras:

src/components/SearchBar.tsx

src/components/TxHistory.tsx

src/components/Badge.tsx

☁️ Deploy on Vercel

Push this repo to GitHub

Import it on Vercel

Add env vars:

NEXT_PUBLIC_BASE_URL=https://your-dashboard.vercel.app
NEXT_PUBLIC_RPC=https://api.devnet.solana.com
NEXT_PUBLIC_IPFS_GATEWAY=https://gateway.pinata.cloud/ipfs


Deploy

Open /now-playing

Note: if you want real data on Vercel, you must either:

commit public/now.json (quick demo), or

have a CI / external job that regenerates it and commits, or

point the dashboard to a remote API that serves the snapshot.

🧪 Quick tests
# 1. run dashboard
npm run dev

# 2. in publisher
cd ../wakama-oracle-publisher
node src/publish.cjs --sim
npm run export_now


Check:

/api/now returns data

/now-playing shows >0 rows

CID/TX links open in a new tab

Record type column shows correct label

🛠️ Troubleshooting

Empty page on Vercel → set NEXT_PUBLIC_BASE_URL to the deployed URL.

Empty table → re-run the publisher and re-export public/now.json.

Tx shows “unknown” → Solana Devnet was slow; run:

solana confirm <SIG> --url https://api.devnet.solana.com --output json


or let the publisher force submitted.

CSP / eval warning → we run the API with runtime = "nodejs" to avoid edge limits.

📝 License & Credits

© 2025 Wakama Edge Ventures. All rights reserved.
Developed by Wakama Edge Ventures (Wakama.farm) — dev@wakama.farm
Supported by Solana Foundation
