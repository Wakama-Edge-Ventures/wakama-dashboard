Wakama Dashboard — Now Playing
Next.js (App Router) UI that displays, in real time, IPFS publications and Solana Devnet transactions for the Wakama Oracle protocol.

Developed by Wakama Edge Ventures (Wakama.farm) — dev@wakama.farm
Supported by Solana Foundation

✨ Features
Now Playing: instant view of latest batches (IPFS CID, Devnet Tx, SHA-256, timestamp).

KPIs: number of files, unique CIDs, on-chain transactions, latest batch time.

Clickable links:

CID → configurable IPFS gateway

Tx → Solana Explorer (cluster Devnet)

Refresh button (manual) + optional auto-refresh (15s)

Status & Source badges in the table:

Status → confirmed / unknown / n/a

Source → simulated / ingest

SSR + revalidation: the page reads /api/now on the server to avoid file sync issues

Solana-styled UI: gradient, glass cards, responsive table

🧱 Architecture (summary)
text
Copier le code
publisher
   └─ writes receipts/*.json
        └─ tools/build-now.cjs (in publisher)
             └─ ../wakama-dashboard/public/now.json  ← snapshot
dashboard
   ├─ serves GET /api/now  ← reads public/now.json
   └─ renders /now-playing ← SSR, sorted by ts desc
public/now.json: aggregated snapshot (generated by the publisher).

GET /api/now: returns the content of public/now.json.

src/app/now-playing/page.tsx: fetches /api/now on the server, sorts by ts desc, shows badges.

Fallback: if /api/now fails (Vercel, network, cold start), the page re-reads public/now.json from disk.

🔧 Prerequisites
Node.js 18+

The publisher repository set up alongside (to generate public/now.json)

Default local layout:

text
Copier le code
~/dev/wakama/wakama-dashboard
~/dev/wakama/wakama-oracle-publisher
Solana Devnet access: https://api.devnet.solana.com

⚙️ Environment variables
Create .env.local at the dashboard root:

dotenv
Copier le code
NEXT_PUBLIC_BASE_URL=http://localhost:3000
NEXT_PUBLIC_RPC=https://api.devnet.solana.com
NEXT_PUBLIC_DASHBOARD_TITLE=Wakama Oracle
NEXT_PUBLIC_IPFS_GATEWAY=https://gateway.pinata.cloud/ipfs
Important (production / Vercel):

dotenv
Copier le code
NEXT_PUBLIC_BASE_URL=https://your-dashboard.vercel.app
This is needed because the page builds the absolute URL to /api/now from the host/proto.

We also provide an example file you can commit: .env.local.example

dotenv
Copier le code
NEXT_PUBLIC_BASE_URL=http://localhost:3000
NEXT_PUBLIC_RPC=https://api.devnet.solana.com
NEXT_PUBLIC_IPFS_GATEWAY=https://gateway.pinata.cloud/ipfs
In your .gitignore, make sure you allow this file:

text
Copier le code
!.env.local.example
🚀 Getting Started
bash
Copier le code
npm install
npm run dev
# http://localhost:3000/now-playing
The page will try to load:

GET http://localhost:3000/api/now

and, if empty/unavailable, public/now.json on disk

If you have not run the publisher yet, the table will be empty.

📦 Integration with the Publisher
In ~/dev/wakama/wakama-oracle-publisher:

Simulated publish + snapshot update (recommended)

bash
Copier le code
npm run publish_sim
Ingest + snapshot update

bash
Copier le code
npm run publish_safe
These scripts do two things:

create a new receipt in wakama-oracle-publisher/receipts/*.json

rebuild the dashboard snapshot:

text
Copier le code
../wakama-dashboard/public/now.json
Then, on the dashboard, reload
👉 http://localhost:3000/now-playing (or click Refresh).

🗂️ Expected snapshot format
The dashboard expects this shape for public/now.json:

json
Copier le code
{
  "totals": {
    "files": 3,
    "cids": 3,
    "onchainTx": 3,
    "lastTs": "2025-10-29T22:27:20.617Z"
  },
  "items": [
    {
      "cid": "Qm...",
      "tx": "5JKL...",
      "file": "wakama-batch-2025-10-29T22-27-20-617Z.json",
      "sha256": "bc0b...",
      "ts": "2025-10-29T22:27:20.617Z",
      "status": "confirmed",
      "slot": 288328921,
      "source": "simulated"
    }
  ]
}
status and source are now displayed in the dashboard

if they are missing, the UI falls back to —

🔌 Endpoints & Key Files
API: GET /api/now → reads public/now.json → { totals, items }
File: src/app/api/now/route.ts

Page: src/app/now-playing/page.tsx (SSR + fallback to disk)

Snapshot: public/now.json (written by the publisher)

☁️ Deploy on Vercel
Push this repo to GitHub

Import on Vercel

Add these env vars in Vercel:

dotenv
Copier le code
NEXT_PUBLIC_BASE_URL=https://your-dashboard.vercel.app
NEXT_PUBLIC_RPC=https://api.devnet.solana.com
NEXT_PUBLIC_IPFS_GATEWAY=https://gateway.pinata.cloud/ipfs
Deploy

Hit /now-playing

Important: if you want the real data to appear on Vercel, you must either:

commit public/now.json (quick demo), or

have a CI / GitHub Action / external publisher that regenerates public/now.json and commits it, or

call a remote API that serves the snapshot.

🧪 Quick Tests
Run the dashboard:

bash
Copier le code
npm run dev
In another terminal, run the publisher:

bash
Copier le code
cd ../wakama-oracle-publisher
npm run publish_sim
Back to the browser:

/api/now returns data

/now-playing shows KPIs > 0 and rows

CID and Tx links are clickable

Status = confirmed (if Solana confirm succeeded)

Source = simulated

🛠️ Troubleshooting
Empty page on Vercel: make sure NEXT_PUBLIC_BASE_URL is set to the deployed URL.

Empty table: run npm run publish_sim again in the publisher (locally) and commit/push public/now.json if needed.

Tx not resolved: confirm manually:

bash
Copier le code
solana confirm <SIG> --url https://api.devnet.solana.com --output json
Changed .env.local: restart npm run dev

CSP / eval error on Vercel: we enforced runtime = nodejs on the API route to avoid edge-specific limits.

📝 License & Credits
© 2025 Wakama Edge Ventures. All rights reserved.
Developed by Wakama Edge Ventures (Wakama.farm) — dev@wakama.farm
Supported by Solana Foundation
